#!/command/with-contenv bash
# shellcheck shell=bash

set -e

echo "‚ùØ Starting backend ..."

if [ "$DEVELOPMENT" == "true" ]; then
	HOME=/tmp/npmuserhome
	GOPATH="$HOME/go"
	mkdir -p "$GOPATH"
	chown -R npmuser:npmuser "$GOPATH"
	export HOME GOPATH
	rm -rf /app/backend/.task
	cd /app/backend || exit 1
	exec s6-setuidgid npmuser task -w
else
	cd /app/bin || exit 1
	exec s6-setuidgid npmuser /app/bin/server
fi
